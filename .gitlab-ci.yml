debian:
        image: git-service.ait.ac.at:8010/ict-caiscluster/logdata-anomaly-miner/aminer-debian

        before_script:
                - service rsyslog start
                - service exim4 start
                - apt install procps -y
                - pip3 install coverage

        script:
                - ansible-playbook /opt/ansible/playbook.yml
                - git clone https://gitlab+deploy-token-aecidtestsuite:vu18Eo6k7xfA22vPvorx@git-service.ait.ac.at/ict-caiscluster/aecid-testsuite.git
                - ln -s /builds/ict-caiscluster/logdata-anomaly-miner/source/root/usr/lib/logdata-anomaly-miner/aminer /builds/ict-caiscluster/logdata-anomaly-miner/aecid-testsuite/aminer
                - cd aecid-testsuite
                - chown -R aminer:aminer /usr/lib/logdata-anomaly-miner
                - chown -h aminer:aminer /usr/bin/AMiner
                - chmod +x /usr/lib/logdata-anomaly-miner/AMiner
                - cd integration
                - cp config* /tmp
                - chmod +x aminerIntegrationTest.sh
                - chmod +x aminerIntegrationTest2.sh
                - ./aminerIntegrationTest.sh
                - ./aminerIntegrationTest2.sh
                - rm /var/mail/mail
                - cd .. #
                - coverage run --source=.. -m unittest discover -s unit -p '*Test.py'
                - touch /tmp/report
                - echo 'Statement Coverage:' > /tmp/report
                - coverage report >> /tmp/report
                - echo > /tmp/report
                - coverage run --source=.. --branch -m unittest discover -s unit -p '*Test.py'
                - echo 'Branch Coverage:' >> /tmp/report
                - coverage report >> /tmp/report
                - cat /tmp/report
                
ubuntu:
        image: git-service.ait.ac.at:8010/ict-caiscluster/logdata-anomaly-miner/aminer-ubuntu
        
        before_script:
                - service rsyslog start
                - service exim4 start
                - pip3 install coverage
        
        script:
                - ansible-playbook /opt/ansible/playbook.yml
                - git clone https://gitlab+deploy-token-aecidtestsuite:vu18Eo6k7xfA22vPvorx@git-service.ait.ac.at/ict-caiscluster/aecid-testsuite.git
                - ln -s /builds/ict-caiscluster/logdata-anomaly-miner/source/root/usr/lib/logdata-anomaly-miner/aminer /builds/ict-caiscluster/logdata-anomaly-miner/aecid-testsuite/aminer
                - cd aecid-testsuite
                - chown -R aminer:aminer /usr/lib/logdata-anomaly-miner
                - chown -h aminer:aminer /usr/bin/AMiner
                - chmod +x /usr/lib/logdata-anomaly-miner/AMiner
                - cd integration
                - cp config* /tmp
                - chmod +x aminerIntegrationTest.sh
                - chmod +x aminerIntegrationTest2.sh
                - ./aminerIntegrationTest.sh
                - ./aminerIntegrationTest2.sh
                - rm /var/mail/mail
                - cd ..
                - coverage run --source=.. -m unittest discover -s unit -p '*Test.py'
                - touch /tmp/report
                - echo 'Statement Coverage:' > /tmp/report
                - coverage report >> /tmp/report
                - echo >> /tmp/report
                - coverage run --source=.. --branch -m unittest discover -s unit -p '*Test.py'
                - echo 'Branch Coverage:' >> /tmp/report
                - coverage report >> /tmp/report
                - cat /tmp/report
